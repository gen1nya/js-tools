<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–°—Ç—Ä–∏–º–µ—Ä—ã ‚Äî Sora Live</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      background-color: #121212;
      color: #fff;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }

    h1 {
      margin-bottom: 2rem;
      font-size: 2rem;
      color: #ccc;
      text-align: center;
    }

    .streamer-list {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .streamer {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: #1e1e1e;
      padding: 0.5rem 1rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
      cursor: pointer;
      transition: background 0.2s;
    }

    .streamer:hover {
      background: #2a2a2a;
    }

    .streamer.active {
      background: #9147ff;
    }

    .streamer img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
    }

    .iframe-wrapper {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    iframe {
      border: none;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }

    #player {
      width: 854px;
      height: 480px;
      max-width: 100%;
    }

    #chat {
      width: 350px;
      height: 660px;
      max-width: 100%;
    }

    .share-link {
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background: #333;
      border-radius: 8px;
      font-size: 0.9rem;
      color: #ccc;
      text-align: center;
      word-break: break-all;
    }

    .copy-btn {
      margin-left: 0.5rem;
      padding: 0.25rem 0.5rem;
      background: #9147ff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
    }

    .copy-btn:hover {
      background: #7b2cbf;
    }

    @media (max-width: 900px) {
      .iframe-wrapper {
        flex-direction: column;
        align-items: center;
      }

      #player, #chat {
        width: 100%;
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
<h1>üí´ –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∏–º–µ—Ä–∞</h1>
<div class="streamer-list" id="streamer-list"></div>

<div class="iframe-wrapper" id="iframe-wrapper" style="display: none;">
  <iframe id="player" allow="fullscreen" allowfullscreen></iframe>
  <iframe id="chat"></iframe>
</div>

<div id="share-container" style="display: none;">
  <div class="share-link">
    –°—Å—ã–ª–∫–∞ –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞: <span id="share-url"></span>
    <button class="copy-btn" onclick="copyShareLink()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
  </div>
</div>

<script>
  const streamers = [
    {
      name: "kurosakissora",
      display: "Kurosaki Sora",
      avatar: "https://static-cdn.jtvnw.net/jtv_user_pictures/29fe8dec-9c2f-485a-884a-99690e84c0a9-profile_image-70x70.png"
    },
    {
      name: "ellis_leaf",
      display: "Ellis Leaf",
      avatar: "https://static-cdn.jtvnw.net/jtv_user_pictures/a79da802-b52f-48c6-89b8-37e078e19ef8-profile_image-70x70.png"
    }
  ];

  const parentDomain = "utils.rus.ebatel.online";

  const list = document.getElementById("streamer-list");
  const player = document.getElementById("player");
  const chat = document.getElementById("chat");
  const wrapper = document.getElementById("iframe-wrapper");
  const shareContainer = document.getElementById("share-container");
  const shareUrl = document.getElementById("share-url");

  let currentStreamer = null;

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  function getUrlParams() {
    const params = new URLSearchParams(window.location.search);
    return {
      streamer: params.get('streamer'),
      channel: params.get('channel') // –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
    };
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  function updateUrl(streamerName) {
    const url = new URL(window.location);
    url.searchParams.set('streamer', streamerName);
    window.history.replaceState({}, '', url);

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞
    shareUrl.textContent = url.toString();
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∏–º–µ—Ä–∞
  function loadStreamer(streamerName) {
    const streamer = streamers.find(s => s.name === streamerName);
    if (!streamer) {
      console.warn(`–°—Ç—Ä–∏–º–µ—Ä "${streamerName}" –Ω–µ –Ω–∞–π–¥–µ–Ω`);
      return false;
    }

    currentStreamer = streamerName;

    // –ó–∞–≥—Ä—É–∂–∞–µ–º iframe'—ã
    player.src = `https://player.twitch.tv/?channel=${streamerName}&parent=${parentDomain}`;
    chat.src = `https://www.twitch.tv/embed/${streamerName}/chat?parent=${parentDomain}`;

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–µ–µ—Ä –∏ —Å—Å—ã–ª–∫—É –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞
    wrapper.style.display = "flex";
    shareContainer.style.display = "block";

    // –û–±–Ω–æ–≤–ª—è–µ–º URL
    updateUrl(streamerName);

    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ç—Ä–∏–º–µ—Ä –≤ —Å–ø–∏—Å–∫–µ
    updateActiveStreamer(streamerName);

    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–ª–µ–µ—Ä—É
    setTimeout(() => {
      window.scrollTo({ top: wrapper.offsetTop - 20, behavior: "smooth" });
    }, 100);

    return true;
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å—Ç—Ä–∏–º–µ—Ä–∞ –≤ —Å–ø–∏—Å–∫–µ
  function updateActiveStreamer(activeStreamerName) {
    document.querySelectorAll('.streamer').forEach(el => {
      el.classList.remove('active');
      if (el.dataset.streamer === activeStreamerName) {
        el.classList.add('active');
      }
    });
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏
  function copyShareLink() {
    const url = shareUrl.textContent;
    navigator.clipboard.writeText(url).then(() => {
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
      btn.style.background = '#28a745';
      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.background = '#9147ff';
      }, 2000);
    }).catch(() => {
      // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
      const textArea = document.createElement('textarea');
      textArea.value = url;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
      alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
    });
  }

  // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–∞ —Å—Ç—Ä–∏–º–µ—Ä–æ–≤
  streamers.forEach(({ name, display, avatar }) => {
    const div = document.createElement("div");
    div.className = "streamer";
    div.dataset.streamer = name;
    div.innerHTML = `<img src="${avatar}" alt="${display}"><span>${display}</span>`;
    div.onclick = () => loadStreamer(name);
    list.appendChild(div);
  });

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  window.addEventListener('DOMContentLoaded', () => {
    const params = getUrlParams();
    const targetStreamer = params.streamer || params.channel;

    if (targetStreamer) {
      if (!loadStreamer(targetStreamer)) {
        // –ï—Å–ª–∏ —Å—Ç—Ä–∏–º–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–ø–∏—Å–∫–µ, –ø–æ–ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞–∫ –∫–∞—Å—Ç–æ–º–Ω—ã–π –∫–∞–Ω–∞–ª
        if (targetStreamer.match(/^[a-zA-Z0-9_]{3,25}$/)) {
          currentStreamer = targetStreamer;
          player.src = `https://player.twitch.tv/?channel=${targetStreamer}&parent=${parentDomain}`;
          chat.src = `https://www.twitch.tv/embed/${targetStreamer}/chat?parent=${parentDomain}`;
          wrapper.style.display = "flex";
          shareContainer.style.display = "block";
          updateUrl(targetStreamer);

          // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞—Å—Ç–æ–º–Ω–æ–º –∫–∞–Ω–∞–ª–µ
          const title = document.querySelector('h1');
          title.innerHTML = `üí´ –°–º–æ—Ç—Ä–∏–º: <span style="color: #9147ff">${targetStreamer}</span>`;
        }
      }
    }
  });

  // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è onclick
  window.copyShareLink = copyShareLink;
</script>
</body>
</html>