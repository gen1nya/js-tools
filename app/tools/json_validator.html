<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Validator & Beautifier</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/json5/2.2.3/index.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInDown 0.8s ease-out;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .privacy-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .main-content {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        .controls {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .workspace {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1px;
            background: #e9ecef;
        }

        .panel {
            background: white;
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            background: #f8f9fa;
            padding: 15px 20px;
            font-weight: 600;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-content {
            flex: 1;
            position: relative;
            display: flex;
        }

        .editor-container {
            display: flex;
            width: 100%;
            height: 450px;
            background: #fafafa;
        }

        .line-numbers {
            background: #f1f3f4;
            color: #666;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            padding: 20px 10px;
            text-align: right;
            user-select: none;
            border-right: 1px solid #e1e4e8;
            min-width: 50px;
            overflow: hidden;
        }

        .editor-textarea {
            flex: 1;
            border: none;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
            outline: none;
            background: transparent;
            white-space: pre;
            overflow-wrap: normal;
        }

        .output {
            width: 100%;
            height: 450px;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            overflow: auto;
            background: #f8f9fa;
            white-space: pre;
        }

        .error-highlight {
            background-color: rgba(255, 0, 0, 0.1) !important;
            border-left: 4px solid #dc3545;
        }

        .error-marker {
            position: absolute;
            background: #dc3545;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
            z-index: 10;
            pointer-events: none;
            animation: pulse 1s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .status {
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status.valid {
            background: #d4edda;
            color: #155724;
            border-top: 3px solid #28a745;
        }

        .status.invalid {
            background: #f8d7da;
            color: #721c24;
            border-top: 3px solid #dc3545;
        }

        .status.neutral {
            background: #e2e3e5;
            color: #383d41;
            border-top: 3px solid #6c757d;
        }

        .status-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: inline-block;
        }

        .status.valid .status-icon {
            background: #28a745;
        }

        .status.invalid .status-icon {
            background: #dc3545;
        }

        .status.neutral .status-icon {
            background: #6c757d;
        }

        .error-details {
            margin-top: 10px;
            padding: 10px;
            background: rgba(220, 53, 69, 0.1);
            border-left: 4px solid #dc3545;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            display: none;
        }

        .footer {
            text-align: center;
            color: rgba(255,255,255,0.8);
            margin-top: 30px;
            font-size: 0.9rem;
        }

        .footer a {
            color: rgba(255,255,255,0.9);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .workspace {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .controls {
                justify-content: center;
            }

            .editor-container {
                height: 300px;
            }

            .output {
                height: 300px;
            }
        }

        .example-link {
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
            font-size: 12px;
        }

        .example-link:hover {
            color: #764ba2;
        }

        .json5-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px 15px;
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid transparent;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .json5-toggle:hover {
            background: rgba(102, 126, 234, 0.15);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .json5-toggle input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .json5-label {
            cursor: pointer;
            font-size: 14px;
            color: #495057;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .json5-active {
            background: rgba(102, 126, 234, 0.2) !important;
            border-color: #667eea !important;
        }

        .json5-active .json5-label {
            color: #667eea;
        }

        /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ JSON */
        .json-key { color: #d73a49; font-weight: bold; }
        .json-string { color: #032f62; }
        .json-number { color: #005cc5; }
        .json-boolean { color: #e36209; }
        .json-null { color: #6f42c1; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>{} JSON Validator</h1>
            <p>–í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ JSON –∏ JSON5 ‚Ä¢ –ù–µ –µ–±–∏—Ç–µ –º–æ–∑–≥–∏</p>
        </div>

        <div class="main-content">
            <div class="controls">
                <button class="btn btn-primary" onclick="validateAndFormat()">
                    ‚ú® –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <button class="btn btn-secondary" onclick="minifyJson()">
                    üì¶ –ú–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <button class="btn btn-secondary" onclick="clearAll()">
                    üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
                </button>
                <button class="btn btn-success" onclick="copyOutput()">
                    üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </button>
                <label class="json5-toggle">
                    <input type="checkbox" id="json5Mode" onchange="toggleJson5Mode()">
                    <span class="json5-label">üöÄ JSON5 —Ä–µ–∂–∏–º</span>
                </label>
            </div>

            <div class="workspace">
                <div class="panel">
                    <div class="panel-header">
                        <span>üìù –ò—Å—Ö–æ–¥–Ω—ã–π JSON</span>
                        <span class="example-link" onclick="loadExample()">–∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–º–µ—Ä</span>
                    </div>
                    <div class="panel-content">
                        <div class="editor-container">
                            <div id="lineNumbers" class="line-numbers">1</div>
                            <textarea 
                                id="input" 
                                class="editor-textarea"
                                placeholder='–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≤–∞—à JSON...

–ù–∞–ø—Ä–∏–º–µ—Ä:
{
  "name": "–ò–≤–∞–Ω",
  "age": 30,
  "city": "–ú–æ—Å–∫–≤–∞"
}'
                                spellcheck="false"
                            ></textarea>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <span>‚úÖ –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                    </div>
                    <div class="panel-content">
                        <div id="output" class="output">–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...</div>
                    </div>
                </div>
            </div>

            <div id="status" class="status neutral">
                <div class="status-icon"></div>
                <span>–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ ‚Ä¢ JSON/JSON5 ‚Ä¢ Ctrl+Enter –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏</span>
                <div id="errorDetails" class="error-details"></div>
            </div>
        </div>

        <div class="footer">
            <p>–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –∏ claude.ai –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ ‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ –±—Ä–∞—É–∑–µ—Ä–µ</p>
        </div>
    </div>

    <script>
        let currentErrorLine = -1;

        function updateLineNumbers() {
            const input = document.getElementById('input');
            const lineNumbers = document.getElementById('lineNumbers');
            const lines = input.value.split('\n');
            
            let numbersHtml = '';
            for (let i = 1; i <= lines.length; i++) {
                const isErrorLine = i === currentErrorLine;
                numbersHtml += `<div class="${isErrorLine ? 'error-highlight' : ''}">${i}</div>`;
            }
            
            lineNumbers.innerHTML = numbersHtml;
        }

        function syncScroll() {
            const input = document.getElementById('input');
            const lineNumbers = document.getElementById('lineNumbers');
            lineNumbers.scrollTop = input.scrollTop;
        }

        function findErrorPosition(jsonString, errorMessage) {
            // –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –ø–æ–∑–∏—Ü–∏—é –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
            const positionMatch = errorMessage.match(/position (\d+)/i);
            if (positionMatch) {
                return parseInt(positionMatch[1]);
            }

            // –ò—â–µ–º –æ–±—â–∏–µ –æ—à–∏–±–∫–∏
            if (errorMessage.includes('Unexpected token')) {
                const tokenMatch = errorMessage.match(/Unexpected token (.+?) in JSON at position (\d+)/);
                if (tokenMatch) {
                    return parseInt(tokenMatch[2]);
                }
            }

            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ—à–∏–±–æ–∫
            if (errorMessage.includes('Unexpected end')) {
                return jsonString.length - 1;
            }

            return -1;
        }

        function getLineAndColumnFromPosition(text, position) {
            if (position < 0) return { line: -1, column: -1 };
            
            const lines = text.substring(0, position).split('\n');
            const line = lines.length;
            const column = lines[lines.length - 1].length + 1;
            
            return { line, column };
        }

        function highlightErrorLine(line) {
            currentErrorLine = line;
            updateLineNumbers();
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Å—Ç—Ä–æ–∫–µ —Å –æ—à–∏–±–∫–æ–π
            const input = document.getElementById('input');
            const lineHeight = parseFloat(window.getComputedStyle(input).lineHeight);
            const scrollTop = (line - 3) * lineHeight; // -3 –¥–ª—è –ø–æ–∫–∞–∑–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            input.scrollTop = Math.max(0, scrollTop);
            syncScroll();
        }

        function toggleJson5Mode() {
            const checkbox = document.getElementById('json5Mode');
            const toggle = checkbox.parentElement;
            const input = document.getElementById('input');
            
            if (checkbox.checked) {
                toggle.classList.add('json5-active');
                input.placeholder = `–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≤–∞—à JSON –∏–ª–∏ JSON5...

JSON5 –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
{
  // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
  name: "–ò–≤–∞–Ω",  // –ö–ª—é—á–∏ –±–µ–∑ –∫–∞–≤—ã—á–µ–∫
  'age': 30,     // –û–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏
  city: "–ú–æ—Å–∫–≤–∞",
  tags: ["dev", "js",], // Trailing comma
}`;
            } else {
                toggle.classList.remove('json5-active');
                input.placeholder = `–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≤–∞—à JSON...

–ù–∞–ø—Ä–∏–º–µ—Ä:
{
  "name": "–ò–≤–∞–Ω",
  "age": 30,
  "city": "–ú–æ—Å–∫–≤–∞"
}`;
            }
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç, –ø–µ—Ä–µ–≤–∞–ª–∏–¥–∏—Ä—É–µ–º
            if (input.value.trim()) {
                validateAndFormat();
            }
        }

        function validateAndFormat() {
            const input = document.getElementById('input').value.trim();
            const output = document.getElementById('output');
            const status = document.getElementById('status');
            const errorDetails = document.getElementById('errorDetails');
            const isJson5Mode = document.getElementById('json5Mode').checked;

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –æ—à–∏–±–æ–∫
            currentErrorLine = -1;
            updateLineNumbers();
            errorDetails.style.display = 'none';

            if (!input) {
                showStatus('neutral', `–í–≤–µ–¥–∏—Ç–µ ${isJson5Mode ? 'JSON/JSON5' : 'JSON'} –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏`);
                output.textContent = '';
                return;
            }

            try {
                const parsed = isJson5Mode ? JSON5.parse(input) : JSON.parse(input);
                const formatted = JSON.stringify(parsed, null, 2);
                
                output.textContent = formatted;
                const objectInfo = Array.isArray(parsed) 
                    ? `–º–∞—Å—Å–∏–≤ –∏–∑ ${parsed.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤`
                    : `–æ–±—ä–µ–∫—Ç —Å ${Object.keys(parsed).length} –∫–ª—é—á–∞–º–∏`;
                    
                const mode = isJson5Mode ? 'JSON5' : 'JSON';
                showStatus('valid', `‚úÖ ${mode} –≤–∞–ª–∏–¥–Ω—ã–π! ${objectInfo}`);
                
                // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
                highlightJsonSyntax(output);
            } catch (error) {
                // –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é –æ—à–∏–±–∫–∏
                const errorPosition = findErrorPosition(input, error.message);
                const { line, column } = getLineAndColumnFromPosition(input, errorPosition);
                
                const mode = isJson5Mode ? 'JSON5' : 'JSON';
                let errorMessage = `‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ ${mode}`;
                if (line > 0) {
                    errorMessage += ` –≤ —Å—Ç—Ä–æ–∫–µ ${line}, –ø–æ–∑–∏—Ü–∏–∏ ${column}`;
                    highlightErrorLine(line);
                }

                showStatus('invalid', errorMessage);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ —Å —É—á–µ—Ç–æ–º —Ä–µ–∂–∏–º–∞
                const suggestions = isJson5Mode ? `
                    <strong>JSON5 –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:</strong><br>
                    ‚Ä¢ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: // –∏ /* */<br>
                    ‚Ä¢ –ö–ª—é—á–∏ –±–µ–∑ –∫–∞–≤—ã—á–µ–∫<br>
                    ‚Ä¢ –û–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –¥–ª—è —Å—Ç—Ä–æ–∫<br>
                    ‚Ä¢ Trailing –∑–∞–ø—è—Ç—ã–µ<br>
                    ‚Ä¢ –ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏<br><br>
                    <strong>–ù–æ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:</strong><br>
                    ‚Ä¢ –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤<br>
                    ‚Ä¢ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å trailing –∑–∞–ø—è—Ç—ã—Ö<br>
                    ‚Ä¢ –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å –∫–ª—é—á–µ–π –±–µ–∑ –∫–∞–≤—ã—á–µ–∫
                ` : `
                    <strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:</strong><br>
                    ‚Ä¢ –í—Å–µ —Å–∫–æ–±–∫–∏ –∏ –∫–∞–≤—ã—á–∫–∏ –∑–∞–∫—Ä—ã—Ç—ã<br>
                    ‚Ä¢ –ù–µ—Ç –ª–∏—à–Ω–∏—Ö –∑–∞–ø—è—Ç—ã—Ö<br>
                    ‚Ä¢ –ö–ª—é—á–∏ –≤ –¥–≤–æ–π–Ω—ã—Ö –∫–∞–≤—ã—á–∫–∞—Ö<br>
                    ‚Ä¢ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤<br><br>
                    üí° <strong>–°–æ–≤–µ—Ç:</strong> –í–∫–ª—é—á–∏—Ç–µ JSON5 —Ä–µ–∂–∏–º –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏ –±–æ–ª–µ–µ –≥–∏–±–∫–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
                `;

                errorDetails.innerHTML = `
                    <strong>–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:</strong><br>
                    ${error.message}<br><br>
                    ${suggestions}
                `;
                errorDetails.style.display = 'block';

                output.textContent = `üö´ ${mode} —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫–∏\n\n${error.message}`;
            }
        }

        function minifyJson() {
            const input = document.getElementById('input').value.trim();
            const output = document.getElementById('output');
            const isJson5Mode = document.getElementById('json5Mode').checked;

            if (!input) {
                showStatus('neutral', `–í–≤–µ–¥–∏—Ç–µ ${isJson5Mode ? 'JSON/JSON5' : 'JSON'} –¥–ª—è –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏`);
                return;
            }

            try {
                const parsed = isJson5Mode ? JSON5.parse(input) : JSON.parse(input);
                const minified = JSON.stringify(parsed);
                
                output.textContent = minified;
                const reduction = ((input.length - minified.length) / input.length * 100).toFixed(1);
                const mode = isJson5Mode ? 'JSON5' : 'JSON';
                showStatus('valid', `‚úÖ ${mode} –º–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω! –†–∞–∑–º–µ—Ä —É–º–µ–Ω—å—à–µ–Ω –Ω–∞ ${reduction}% (${input.length} ‚Üí ${minified.length} —Å–∏–º–≤–æ–ª–æ–≤)`);
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –æ—à–∏–±–æ–∫
                currentErrorLine = -1;
                updateLineNumbers();
            } catch (error) {
                const mode = isJson5Mode ? 'JSON5' : 'JSON';
                showStatus('invalid', `‚ùå –û—à–∏–±–∫–∞ –≤ ${mode}: ${error.message}`);
            }
        }

        function clearAll() {
            document.getElementById('input').value = '';
            document.getElementById('output').textContent = '–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...';
            currentErrorLine = -1;
            updateLineNumbers();
            document.getElementById('errorDetails').style.display = 'none';
            showStatus('neutral', '–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ ‚Ä¢ JSON/JSON5 ‚Ä¢ Ctrl+Enter –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏');
        }

        function copyOutput() {
            const output = document.getElementById('output').textContent;
            
            if (output === '–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...' || output.startsWith('üö´ JSON —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫–∏')) {
                showStatus('neutral', '–ù–µ—á–µ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å');
                return;
            }

            navigator.clipboard.writeText(output).then(() => {
                showStatus('valid', 'üìã –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                setTimeout(() => {
                    if (document.getElementById('status').classList.contains('valid')) {
                        showStatus('valid', 'JSON –≤–∞–ª–∏–¥–Ω—ã–π!');
                    }
                }, 2000);
            }).catch(() => {
                showStatus('invalid', '–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
            });
        }

        function loadExample() {
            const isJson5Mode = document.getElementById('json5Mode').checked;
            const input = document.getElementById('input');
            
            if (isJson5Mode) {
                // JSON5 –ø—Ä–∏–º–µ—Ä —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏, –∫–ª—é—á–∞–º–∏ –±–µ–∑ –∫–∞–≤—ã—á–µ–∫ –∏ trailing comma
                const json5Example = `{
  // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
  user: {
    id: 12345,
    name: "–ê–Ω–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞",
    'email': 'anna@example.com', // –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç
    isActive: true,
    balance: 2750.80,
    
    /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
       –º–æ–≥—É—Ç –±—ã—Ç—å –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–º–∏ */
    preferences: {
      language: "ru",
      notifications: true,
      theme: "dark", // trailing comma –∑–¥–µ—Å—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∞
    },
    
    tags: [
      "premium", 
      "verified", 
      "early-adopter", // –∏ –∑–¥–µ—Å—å —Ç–æ–∂–µ
    ],
    
    lastLogin: "2025-09-21T10:30:00Z",
    metadata: null, // —Ñ–∏–Ω–∞–ª—å–Ω–∞—è trailing comma
  }
}`;
                input.value = json5Example;
            } else {
                // –û–±—ã—á–Ω—ã–π JSON –ø—Ä–∏–º–µ—Ä
                const jsonExample = {
                    "user": {
                        "id": 12345,
                        "name": "–ê–Ω–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞",
                        "email": "anna.smirnova@example.com",
                        "isActive": true,
                        "balance": 2750.80,
                        "preferences": {
                            "language": "ru",
                            "notifications": true,
                            "theme": "dark"
                        },
                        "tags": ["premium", "verified", "early-adopter"],
                        "lastLogin": "2025-09-21T10:30:00Z",
                        "metadata": null
                    }
                };
                input.value = JSON.stringify(jsonExample, null, 2);
            }
            
            updateLineNumbers();
            const mode = isJson5Mode ? 'JSON5' : 'JSON';
            showStatus('neutral', `${mode} –ø—Ä–∏–º–µ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω - –Ω–∞–∂–º–∏—Ç–µ "–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å" –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏`);
        }

        function showStatus(type, message) {
            const status = document.getElementById('status');
            status.className = `status ${type}`;
            status.querySelector('span').textContent = message;
        }

        function highlightJsonSyntax(element) {
            let content = element.textContent;
            
            content = content
                .replace(/(".*?")\s*:/g, '<span class="json-key">$1</span>:')
                .replace(/:\s*(".*?")/g, ': <span class="json-string">$1</span>')
                .replace(/:\s*(\d+\.?\d*)/g, ': <span class="json-number">$1</span>')
                .replace(/:\s*(true|false)/g, ': <span class="json-boolean">$1</span>')
                .replace(/:\s*(null)/g, ': <span class="json-null">$1</span>');
            
            element.innerHTML = content;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('input');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ
            input.addEventListener('input', function() {
                updateLineNumbers();
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
                clearTimeout(window.validationTimeout);
                window.validationTimeout = setTimeout(() => {
                    if (this.value.trim()) {
                        validateAndFormat();
                    }
                }, 800);
            });

            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–∞
            input.addEventListener('scroll', syncScroll);

            // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
            input.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    e.preventDefault();
                    validateAndFormat();
                }
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫
            updateLineNumbers();
        });
    </script>
</body>
</html>